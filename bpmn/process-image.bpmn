<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" id="Definitions_0sfs7mp" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.1.0">
  <bpmn:process id="Process_1" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1" camunda:formKey="start">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="s3Url" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:outgoing>SequenceFlow_0n70h8i</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0n70h8i" sourceRef="StartEvent_1" targetRef="ExclusiveGateway_1g1p8o2" />
    <bpmn:parallelGateway id="ExclusiveGateway_1g1p8o2">
      <bpmn:incoming>SequenceFlow_0n70h8i</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_02y2zqm</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1ny5mzt</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:sequenceFlow id="SequenceFlow_02y2zqm" sourceRef="ExclusiveGateway_1g1p8o2" targetRef="ServiceTask_12dk4h6" />
    <bpmn:serviceTask id="ServiceTask_0ojfx5l" name="Make image thumbnail" camunda:type="external" camunda:topic="generate-thumbnail">
      <bpmn:documentation>@typescript

type Input {
 s3Url: string
}

type Output {
 s3Url: string
}</bpmn:documentation>
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="s3Url" />
          <camunda:outputParameter name="thumbnailS3Url" />
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1ny5mzt</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0v6mjsk</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_1ny5mzt" sourceRef="ExclusiveGateway_1g1p8o2" targetRef="ServiceTask_0ojfx5l" />
    <bpmn:sequenceFlow id="SequenceFlow_0v6mjsk" sourceRef="ServiceTask_0ojfx5l" targetRef="ExclusiveGateway_09641k2" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_09641k2">
      <bpmn:incoming>SequenceFlow_0v6mjsk</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_1oifa5m</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1783td9</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="ServiceTask_1yoiuls" name="Save to profile" camunda:type="external" camunda:topic="save-profile-image">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="Input_23vv2pm" />
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1783td9</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_154lnj2</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1t2om4r</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_1783td9" sourceRef="ExclusiveGateway_09641k2" targetRef="ServiceTask_1yoiuls" />
    <bpmn:sequenceFlow id="SequenceFlow_1oifa5m" sourceRef="ServiceTask_0u5uf3r" targetRef="ExclusiveGateway_09641k2" />
    <bpmn:endEvent id="EndEvent_07aa2rk" name="Fail">
      <bpmn:incoming>SequenceFlow_1vkix30</bpmn:incoming>
      <bpmn:errorEventDefinition />
    </bpmn:endEvent>
    <bpmn:endEvent id="EndEvent_1ysvbd8">
      <bpmn:incoming>SequenceFlow_1lowl75</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_154lnj2" sourceRef="ServiceTask_1yoiuls" targetRef="ExclusiveGateway_0v1ubke" />
    <bpmn:sequenceFlow id="SequenceFlow_1fkidf6" sourceRef="Task_1s9hlsw" targetRef="Task_154abi7" />
    <bpmn:sequenceFlow id="SequenceFlow_1qeg25u" sourceRef="Task_1dd25vi" targetRef="ExclusiveGateway_179otot" />
    <bpmn:sendTask id="Task_1dd25vi" name="Notify app">
      <bpmn:incoming>SequenceFlow_0tkvuqy</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1qeg25u</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:sequenceFlow id="SequenceFlow_1vkix30" sourceRef="Task_154abi7" targetRef="EndEvent_07aa2rk" />
    <bpmn:businessRuleTask id="ServiceTask_0u5uf3r" name="Recalc score" camunda:decisionRef="score">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="isSmiling" />
          <camunda:inputParameter name="smilingConfidence" />
          <camunda:outputParameter name="score" />
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_089tzgv</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1oifa5m</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:serviceTask id="Task_1s9hlsw" name="Remove" camunda:type="external" camunda:topic="remove-assets">
      <bpmn:incoming>SequenceFlow_0u3b1pg</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1fkidf6</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sendTask id="Task_154abi7" name="Notify app" camunda:type="external" camunda:topic="notify-app-task">
      <bpmn:incoming>SequenceFlow_1fkidf6</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1vkix30</bpmn:outgoing>
    </bpmn:sendTask>
    <bpmn:sequenceFlow id="SequenceFlow_1t2om4r" sourceRef="ServiceTask_1yoiuls" targetRef="ExclusiveGateway_0v1ubke" />
    <bpmn:sequenceFlow id="SequenceFlow_0tkvuqy" sourceRef="ExclusiveGateway_0v1ubke" targetRef="Task_1dd25vi" />
    <bpmn:parallelGateway id="ExclusiveGateway_0v1ubke">
      <bpmn:incoming>SequenceFlow_1t2om4r</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_154lnj2</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0tkvuqy</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1tug2mb</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1tug2mb" sourceRef="ExclusiveGateway_0v1ubke" targetRef="Task_16eg9ak" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_179otot">
      <bpmn:incoming>SequenceFlow_18socnx</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_1qeg25u</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1lowl75</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_18socnx" sourceRef="Task_16eg9ak" targetRef="ExclusiveGateway_179otot" />
    <bpmn:sequenceFlow id="SequenceFlow_1lowl75" sourceRef="ExclusiveGateway_179otot" targetRef="EndEvent_1ysvbd8" />
    <bpmn:serviceTask id="Task_16eg9ak" name="Remove old profile pic" camunda:expression="remove-assets">
      <bpmn:incoming>SequenceFlow_1tug2mb</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_18socnx</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="ServiceTask_12dk4h6" name="Find face" camunda:type="external" camunda:topic="find-face">
      <bpmn:documentation>@typescript

type Input {
 s3Url: string
}

type Output {
  refId: string
  smiling: boolean
  smilingConfidence: number
}</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="" />
        <camunda:inputOutput>
          <camunda:inputParameter name="s3Url" />
          <camunda:outputParameter name="isSmiling" />
          <camunda:outputParameter name="smilingConfidence" />
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_02y2zqm</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_089tzgv</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_089tzgv" sourceRef="ServiceTask_12dk4h6" targetRef="ServiceTask_0u5uf3r" />
    <bpmn:boundaryEvent id="BoundaryEvent_05a6jp0" attachedToRef="ServiceTask_12dk4h6">
      <bpmn:outgoing>SequenceFlow_0u3b1pg</bpmn:outgoing>
      <bpmn:errorEventDefinition errorRef="Error_05vdzc9" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0u3b1pg" sourceRef="BoundaryEvent_05a6jp0" targetRef="Task_1s9hlsw" />
  </bpmn:process>
  <bpmn:error id="Error_05vdzc9" name="REK_NO_PERSON" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="195" y="164" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0n70h8i_di" bpmnElement="SequenceFlow_0n70h8i">
        <di:waypoint x="231" y="182" />
        <di:waypoint x="259" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ParallelGateway_0zwb72x_di" bpmnElement="ExclusiveGateway_1g1p8o2">
        <dc:Bounds x="259" y="157" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_02y2zqm_di" bpmnElement="SequenceFlow_02y2zqm">
        <di:waypoint x="284" y="207" />
        <di:waypoint x="284" y="231" />
        <di:waypoint x="336" y="231" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_0ojfx5l_di" bpmnElement="ServiceTask_0ojfx5l" bioc:stroke="rgb(251, 140, 0)" bioc:fill="rgb(255, 224, 178)">
        <dc:Bounds x="411" y="81" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1ny5mzt_di" bpmnElement="SequenceFlow_1ny5mzt">
        <di:waypoint x="284" y="157" />
        <di:waypoint x="284" y="121" />
        <di:waypoint x="411" y="121" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0v6mjsk_di" bpmnElement="SequenceFlow_0v6mjsk">
        <di:waypoint x="511" y="121" />
        <di:waypoint x="614" y="121" />
        <di:waypoint x="614" y="157" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_1k0m3hh_di" bpmnElement="ExclusiveGateway_09641k2" isMarkerVisible="true">
        <dc:Bounds x="589" y="157" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_1yoiuls_di" bpmnElement="ServiceTask_1yoiuls">
        <dc:Bounds x="663" y="142" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1783td9_di" bpmnElement="SequenceFlow_1783td9">
        <di:waypoint x="639" y="182" />
        <di:waypoint x="663" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1oifa5m_di" bpmnElement="SequenceFlow_1oifa5m">
        <di:waypoint x="559" y="231" />
        <di:waypoint x="614" y="231" />
        <di:waypoint x="614" y="207" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0xdbujp_di" bpmnElement="EndEvent_07aa2rk">
        <dc:Bounds x="788" y="344" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="797" y="320" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1ysvbd8_di" bpmnElement="EndEvent_1ysvbd8">
        <dc:Bounds x="1076" y="164" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_154lnj2_di" bpmnElement="SequenceFlow_154lnj2">
        <di:waypoint x="763" y="182" />
        <di:waypoint x="781" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1fkidf6_di" bpmnElement="SequenceFlow_1fkidf6">
        <di:waypoint x="573" y="364" />
        <di:waypoint x="636" y="364" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1qeg25u_di" bpmnElement="SequenceFlow_1qeg25u">
        <di:waypoint x="964" y="182" />
        <di:waypoint x="995" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="SendTask_1dwkmpb_di" bpmnElement="Task_1dd25vi">
        <dc:Bounds x="864" y="142" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1vkix30_di" bpmnElement="SequenceFlow_1vkix30">
        <di:waypoint x="736" y="363" />
        <di:waypoint x="788" y="363" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BusinessRuleTask_1edm1fs_di" bpmnElement="ServiceTask_0u5uf3r" bioc:stroke="rgb(229, 57, 53)" bioc:fill="rgb(255, 205, 210)">
        <dc:Bounds x="459" y="191" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_0n97h05_di" bpmnElement="Task_1s9hlsw">
        <dc:Bounds x="473" y="324" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="SendTask_0zeips7_di" bpmnElement="Task_154abi7">
        <dc:Bounds x="636" y="324" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1t2om4r_di" bpmnElement="SequenceFlow_1t2om4r">
        <di:waypoint x="763" y="182" />
        <di:waypoint x="781" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0tkvuqy_di" bpmnElement="SequenceFlow_0tkvuqy">
        <di:waypoint x="831" y="182" />
        <di:waypoint x="864" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ParallelGateway_05lo3qo_di" bpmnElement="ExclusiveGateway_0v1ubke">
        <dc:Bounds x="781" y="157" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1tug2mb_di" bpmnElement="SequenceFlow_1tug2mb">
        <di:waypoint x="806" y="207" />
        <di:waypoint x="806" y="292" />
        <di:waypoint x="864" y="292" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_179otot_di" bpmnElement="ExclusiveGateway_179otot" isMarkerVisible="true">
        <dc:Bounds x="995" y="157" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_18socnx_di" bpmnElement="SequenceFlow_18socnx">
        <di:waypoint x="964" y="292" />
        <di:waypoint x="1020" y="292" />
        <di:waypoint x="1020" y="207" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1lowl75_di" bpmnElement="SequenceFlow_1lowl75">
        <di:waypoint x="1045" y="182" />
        <di:waypoint x="1076" y="182" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_03rms5w_di" bpmnElement="Task_16eg9ak">
        <dc:Bounds x="864" y="252" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_12dk4h6_di" bpmnElement="ServiceTask_12dk4h6" bioc:stroke="rgb(142, 36, 170)" bioc:fill="rgb(225, 190, 231)">
        <dc:Bounds x="336" y="191" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_089tzgv_di" bpmnElement="SequenceFlow_089tzgv">
        <di:waypoint x="436" y="231" />
        <di:waypoint x="459" y="231" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BoundaryEvent_0pf1khr_di" bpmnElement="BoundaryEvent_05a6jp0">
        <dc:Bounds x="372" y="253" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0u3b1pg_di" bpmnElement="SequenceFlow_0u3b1pg">
        <di:waypoint x="390" y="289" />
        <di:waypoint x="390" y="364" />
        <di:waypoint x="473" y="364" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
